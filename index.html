<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>資產再平衡計算機</title>
    
    <!-- React 和相關依賴 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.js"></script>
    
    <style>
        /* 自定義元件樣式 */
        .card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
            padding: 1.5rem;
        }
        .input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
        }
        .alert {
            padding: 1rem;
            border-radius: 0.375rem;
            margin: 1rem 0;
        }
        .slider {
            width: 100%;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div id="root"></div>
    
    <script type="text/babel">
        // 模擬 shadcn/ui 組件
        const Card = ({ children, className }) => (
            <div className={`card ${className}`}>{children}</div>
        );
        
        const CardHeader = ({ children }) => (
            <div className="mb-4">{children}</div>
        );
        
        const CardTitle = ({ children, className }) => (
            <h2 className={`text-xl font-bold ${className}`}>{children}</h2>
        );
        
        const CardContent = ({ children }) => (
            <div>{children}</div>
        );
        
        const Input = ({ className, ...props }) => (
            <input className={`input ${className}`} {...props} />
        );
        
        const Alert = ({ children, className }) => (
            <div className={`alert ${className}`}>{children}</div>
        );
        
        const AlertDescription = ({ children }) => (
            <div>{children}</div>
        );
        
        const Slider = ({ value, onValueChange, min, max, step, className }) => (
            <input
                type="range"
                value={value}
                onChange={(e) => onValueChange([parseFloat(e.target.value)])}
                min={min}
                max={max}
                step={step}
                className={`slider ${className}`}
            />
        );

        // 您的完整 RebalanceCalculator 組件代碼放在這裡import React, { useState } from 'react';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Slider } from '@/components/ui/slider';
import { Calculator, TrendingDown, TrendingUp } from 'lucide-react';

// 格式化數字到小數點後兩位
const formatPercentage = (value) => {
  return Number(value).toFixed(2);
};

const PieChart = ({ data, colors }) => {
  const total = data.reduce((sum, item) => sum + item.value, 0);
  let startAngle = 0;
  
  return (
    <svg viewBox="-100 -100 200 200" style={{ transform: 'rotate(-90deg)' }}>
      {data.map((item, index) => {
        const angle = (item.value / total) * 360;
        const largeArcFlag = angle > 180 ? 1 : 0;
        const endAngle = startAngle + angle;
        
        const startRad = (startAngle * Math.PI) / 180;
        const endRad = (endAngle * Math.PI) / 180;
        
        const x1 = 60 * Math.cos(startRad);
        const y1 = 60 * Math.sin(startRad);
        const x2 = 60 * Math.cos(endRad);
        const y2 = 60 * Math.sin(endRad);
        
        const x1Inner = 30 * Math.cos(startRad);
        const y1Inner = 30 * Math.sin(startRad);
        const x2Inner = 30 * Math.cos(endRad);
        const y2Inner = 30 * Math.sin(endRad);
        
        const path = [
          `M ${x1} ${y1}`,
          `A 60 60 0 ${largeArcFlag} 1 ${x2} ${y2}`,
          `L ${x2Inner} ${y2Inner}`,
          `A 30 30 0 ${largeArcFlag} 0 ${x1Inner} ${y1Inner}`,
          'Z'
        ].join(' ');
        
        startAngle += angle;
        
        return (
          <path
            key={index}
            d={path}
            fill={colors[index]}
            stroke="white"
            strokeWidth="1"
          />
        );
      })}
    </svg>
  );
};

const RebalanceCalculator = () => {
  const [currentStocks, setCurrentStocks] = useState('');
  const [currentCash, setCurrentCash] = useState('');
  const [targetStockRatio, setTargetStockRatio] = useState(50.00);

  const COLORS = {
    current: ['#3b82f6', '#93c5fd'],
    target: ['#059669', '#86efac']
  };

  const formatCurrency = (value) => {
    return new Intl.NumberFormat('zh-TW', {
      style: 'decimal',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(value);
  };

  const handleTargetRatioChange = (value) => {
    // 處理滑桿輸入，限制小數點後兩位
    setTargetStockRatio(Number(formatPercentage(value)));
  };

  const handleManualRatioInput = (value, isStock = true) => {
    // 處理手動輸入，限制小數點後兩位
    let newValue = value === '' ? 0 : Number(value);
    if (isStock) {
      newValue = Math.min(100, Math.max(0, newValue));
      setTargetStockRatio(Number(formatPercentage(newValue)));
    } else {
      newValue = Math.min(100, Math.max(0, newValue));
      setTargetStockRatio(Number(formatPercentage(100 - newValue)));
    }
  };

  const calculateRebalance = () => {
    const totalStocks = Number(currentStocks);
    const totalCash = Number(currentCash);
    const totalAssets = totalStocks + totalCash;
    
    const currentStockRatio = (totalStocks / totalAssets) * 100;
    const targetAmount = totalAssets * (targetStockRatio / 100);
    const adjustment = targetAmount - totalStocks;
    
    return {
      totalAssets,
      currentStockRatio: Number(formatPercentage(currentStockRatio)),
      adjustment,
      targetCash: totalAssets - targetAmount,
      targetStocks: targetAmount,
      currentCashRatio: Number(formatPercentage(100 - currentStockRatio))
    };
  };

  const results = currentStocks && currentCash ? calculateRebalance() : null;
  const cashRatio = Number(formatPercentage(100 - targetStockRatio));

  const getCurrentChartData = () => {
    if (!results) return [];
    return [
      { name: '股票', value: results.currentStockRatio },
      { name: '現金', value: results.currentCashRatio }
    ];
  };

  const getTargetChartData = () => {
    return [
      { name: '股票', value: Number(targetStockRatio) },
      { name: '現金', value: cashRatio }
    ];
  };

  return (
    <Card className="w-full max-w-2xl">
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Calculator className="w-5 h-5" />
          資產再平衡計算機
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-6">
        <div className="space-y-4">
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="text-sm font-medium">目前股票金額</label>
              <Input
                type="number"
                value={currentStocks}
                onChange={(e) => setCurrentStocks(e.target.value)}
                placeholder="輸入股票現值"
                className="mt-1"
              />
            </div>
            <div>
              <label className="text-sm font-medium">目前現金金額</label>
              <Input
                type="number"
                value={currentCash}
                onChange={(e) => setCurrentCash(e.target.value)}
                placeholder="輸入現金金額"
                className="mt-1"
              />
            </div>
          </div>

          <div className="pt-4">
            <label className="text-sm font-medium">目標股票配置比例：{formatPercentage(targetStockRatio)}%</label>
            <div className="flex items-center gap-4">
              <Slider
                value={[targetStockRatio]}
                onValueChange={([value]) => handleTargetRatioChange(value)}
                min={0}
                max={100}
                step={0.01}
                className="flex-1"
              />
              <div className="text-sm text-gray-500 min-w-[180px]">
                股票:{formatPercentage(targetStockRatio)}% / 現金:{formatPercentage(cashRatio)}%
              </div>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-4">
            <Input
              type="number"
              value={formatPercentage(targetStockRatio)}
              onChange={(e) => handleManualRatioInput(e.target.value, true)}
              className="text-center"
              min="0"
              max="100"
              step="0.01"
            />
            <Input
              type="number"
              value={formatPercentage(cashRatio)}
              onChange={(e) => handleManualRatioInput(e.target.value, false)}
              className="text-center"
              min="0"
              max="100"
              step="0.01"
            />
          </div>
        </div>

        {results && (
          <>
            <div className="grid grid-cols-2 gap-8 mt-6">
              <div className="text-center">
                <div className="font-medium mb-2">目前配置</div>
                <div className="w-48 h-48 mx-auto">
                  <PieChart data={getCurrentChartData()} colors={COLORS.current} />
                </div>
                <div className="mt-2 space-y-1">
                  <div className="flex justify-center items-center gap-2">
                    <div className="w-3 h-3 bg-[#3b82f6]"></div>
                    <div className="text-sm">股票 {formatPercentage(results.currentStockRatio)}%</div>
                  </div>
                  <div className="flex justify-center items-center gap-2">
                    <div className="w-3 h-3 bg-[#93c5fd]"></div>
                    <div className="text-sm">現金 {formatPercentage(results.currentCashRatio)}%</div>
                  </div>
                </div>
                <div className="text-sm text-gray-600 mt-2">
                  總資產：{formatCurrency(results.totalAssets)} 元
                </div>
              </div>

              <div className="text-center">
                <div className="font-medium mb-2">目標配置</div>
                <div className="w-48 h-48 mx-auto">
                  <PieChart data={getTargetChartData()} colors={COLORS.target} />
                </div>
                <div className="mt-2 space-y-1">
                  <div className="flex justify-center items-center gap-2">
                    <div className="w-3 h-3 bg-[#059669]"></div>
                    <div className="text-sm">股票 {formatPercentage(targetStockRatio)}%</div>
                  </div>
                  <div className="flex justify-center items-center gap-2">
                    <div className="w-3 h-3 bg-[#86efac]"></div>
                    <div className="text-sm">現金 {formatPercentage(cashRatio)}%</div>
                  </div>
                </div>
                <div className="text-sm text-gray-600 mt-2">
                  調整後股票：{formatCurrency(results.targetStocks)} 元
                </div>
              </div>
            </div>

            <div className="space-y-4">
              <div className="font-medium">建議調整方案</div>
              {Math.abs(results.adjustment) > 1000 && (
                <Alert className={results.adjustment > 0 ? "bg-green-50" : "bg-blue-50"}>
                  <AlertDescription className="flex items-center gap-2">
                    {results.adjustment > 0 ? (
                      <TrendingUp className="w-4 h-4 text-green-600" />
                    ) : (
                      <TrendingDown className="w-4 h-4 text-blue-600" />
                    )}
                    {results.adjustment > 0 
                      ? `建議買入股票：${formatCurrency(Math.abs(results.adjustment))} 元` 
                      : `建議賣出股票：${formatCurrency(Math.abs(results.adjustment))} 元`}
                  </AlertDescription>
                </Alert>
              )}

              <div className="grid grid-cols-2 gap-4 text-sm bg-gray-50 p-4 rounded-lg">
                <div>
                  <div className="text-gray-600">調整後股票金額</div>
                  <div className="font-medium">{formatCurrency(results.targetStocks)} 元 ({formatPercentage(targetStockRatio)}%)</div>
                </div>
                <div>
                  <div className="text-gray-600">調整後現金金額</div>
                  <div className="font-medium">{formatCurrency(results.targetCash)} 元 ({formatPercentage(cashRatio)}%)</div>
                </div>
              </div>
            </div>
          </>
        )}
      </CardContent>
    </Card>
  );
};

export default RebalanceCalculator;
        import React, { useState } from 'react';
        const { Calculator, TrendingDown, TrendingUp } = window.lucide;

        // 這裡複製您的完整 RebalanceCalculator 組件代碼

        // 渲染應用程式
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RebalanceCalculator />);
    </script>
</body>
</html>
