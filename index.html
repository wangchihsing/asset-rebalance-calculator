<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>資產再平衡計算機</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        input[type="range"] {
            height: 8px;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
        }
        input[type="range"]::-webkit-slider-runnable-track {
            background: linear-gradient(to right, #3b82f6 var(--value, 50%), #ddd 0%);
            height: 8px;
            border-radius: 4px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-lg shadow-sm p-6 ${className}`}>{children}</div>
        );

        const CardHeader = ({ children }) => (
            <div className="mb-6">{children}</div>
        );

        const CardTitle = ({ children, className }) => (
            <h2 className={`text-xl font-bold ${className}`}>{children}</h2>
        );

        const CardContent = ({ children, className }) => (
            <div className={className}>{children}</div>
        );

        const Input = React.forwardRef((props, ref) => (
            <input {...props} ref={ref} className={`w-full p-2 border rounded-md ${props.className}`} />
        ));

        const Alert = ({ children, className }) => (
            <div className={`p-4 rounded-md ${className}`}>{children}</div>
        );

        const AlertDescription = ({ children }) => (
            <div className="text-sm">{children}</div>
        );

        const Slider = ({ value, onValueChange, ...props }) => {
            const handleInputChange = (e) => {
                const val = parseFloat(e.target.value);
                e.target.style.setProperty('--value', `${val}%`);
                onValueChange([val]);
            };

            return (
                <div className="slider-container">
                    <input
                        type="range"
                        value={value[0]}
                        onChange={handleInputChange}
                        style={{ '--value': `${value[0]}%` }}
                        {...props}
                    />
                </div>
            );
        };

        const PieChart = ({ data, colors }) => {
            const total = data.reduce((sum, item) => sum + item.value, 0);
            let startAngle = 0;

            return (
                <svg viewBox="-100 -100 200 200" style={{ transform: 'rotate(-90deg)' }}>
                    {data.map((item, index) => {
                        const angle = (item.value / total) * 360;
                        const largeArcFlag = angle > 180 ? 1 : 0;
                        const endAngle = startAngle + angle;
                        const startRad = (startAngle * Math.PI) / 180;
                        const endRad = (endAngle * Math.PI) / 180;
                        const x1 = 60 * Math.cos(startRad);
                        const y1 = 60 * Math.sin(startRad);
                        const x2 = 60 * Math.cos(endRad);
                        const y2 = 60 * Math.sin(endRad);

                        const path = [
                            `M ${x1} ${y1}`,
                            `A 60 60 0 ${largeArcFlag} 1 ${x2} ${y2}`,
                            `L 0 0`,
                            'Z'
                        ].join(' ');

                        startAngle += angle;

                        return <path key={index} d={path} fill={colors[index]} />;
                    })}
                </svg>
            );
        };

        const RebalanceCalculator = () => {
            const [currentStocks, setCurrentStocks] = React.useState('');
            const [currentCash, setCurrentCash] = React.useState('');
            const [targetStockRatio, setTargetStockRatio] = React.useState(50);

            const formatPercentage = (value) => Number(value).toFixed(2);

            const handleManualRatioInput = (value, isStock) => {
                const newValue = parseFloat(value) || 0;
                if (isStock) {
                    setTargetStockRatio(Math.min(100, Math.max(0, newValue)));
                }
            };

            const calculateRebalance = () => {
                const totalStocks = parseFloat(currentStocks) || 0;
                const totalCash = parseFloat(currentCash) || 0;
                const totalAssets = totalStocks + totalCash;
                const targetStockAmount = (targetStockRatio / 100) * totalAssets;
                const adjustment = targetStockAmount - totalStocks;

                return {
                    totalAssets,
                    targetStockAmount,
                    adjustment,
                };
            };

            const results = currentStocks && currentCash ? calculateRebalance() : null;

            return (
                <Card className="max-w-2xl mx-auto my-8">
                    <CardHeader>
                        <CardTitle>資產再平衡計算機</CardTitle>
                    </CardHeader>
                    <CardContent>
                        <div>
                            <Input
                                type="number"
                                value={currentStocks}
                                onChange={(e) => setCurrentStocks(e.target.value)}
                                placeholder="目前股票金額"
                            />
                            <Input
                                type="number"
                                value={currentCash}
                                onChange={(e) => setCurrentCash(e.target.value)}
                                placeholder="目前現金金額"
                            />
                        </div>
                        <Slider
                            value={[targetStockRatio]}
                            onValueChange={([val]) => setTargetStockRatio(val)}
                            min={0}
                            max={100}
                        />
                        {results && (
                            <Alert>
                                <AlertDescription>
                                    {results.adjustment > 0
                                        ? `建議買入股票 ${results.adjustment} 元`
                                        : `建議賣出股票 ${Math.abs(results.adjustment)} 元`}
                                </AlertDescription>
                            </Alert>
                        )}
                    </CardContent>
                </Card>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RebalanceCalculator />);
    </script>
</body>
</html>
